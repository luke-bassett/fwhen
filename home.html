<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{{.Page.Title}}</title>
  <link rel="stylesheet" type="text/css" href="/static/style.css">
</head>

<body>
  <script>
    // stackoverflow.com/questions/20618355
    function startTimer(duration, element) {
    var timer = duration, d, h, m, s;
    setInterval(function () {
        d = parseInt(timer / 86400, 10);
        h = parseInt(timer % 86400 / 3600, 10);
        m = parseInt(timer % 3600 / 60, 10);
        s = parseInt(timer % 60, 10);

        h = h < 10 ? "0" + h : h;
        m = m < 10 ? "0" + m : m;
        s = s < 10 ? "0" + s : s;

        element.textContent = d + "d " + h + "h " + m + "m " + s + "s";

        if (--timer < 0) {
            timer = duration;
        }
    }, 1000);
    }

    window.onload = function() {

      // get data
      const raceData = JSON.parse("{{.Page.Data}}")

      var racesDiv = document.getElementById("races")

      for (i = 0; i < raceData.length; i++) {  
        let race = raceData[i]

        // add name row
        let raceNameSpan = document.createElement("span")
        raceNameSpan.innerHTML = race.Name
        raceNameSpan.className = "race_name"
        racesDiv.appendChild(raceNameSpan)

        // create flex container
        let flexDiv = document.createElement("div")
        flexDiv.className = "flex-container"
        // create session name div and timer div
        let sessionNamesDiv = document.createElement("div") 
        let timerDiv = document.createElement("div") 

        for (j = 0; j < race.Sessions.length; j++) {
          let session = race.Sessions[j]

          // add session names
          let sessionNameSpan = document.createElement("span")
          sessionNameSpan.innerHTML = session.Name
          sessionNamesDiv.appendChild(sessionNameSpan)
          sessionNamesDiv.appendChild(document.createElement("br"))

          // add timers
          let sessionTimerSpan = document.createElement("span")
          // sessionTimerSpan.innerHTML = session.NsToStart
          startTimer(session.NsToStart / 10**9, sessionTimerSpan)
          timerDiv.appendChild(sessionTimerSpan)
          timerDiv.appendChild(document.createElement("br"))
        }
        flexDiv.appendChild(sessionNamesDiv)
        flexDiv.appendChild(timerDiv)
        racesDiv.appendChild(flexDiv)

      }
    }
  </script>

    <h1>
      <span class="title_1">formula</span><span class="title_2">when</span>
    </h1>
    <div id="races"></div>
</body>
</html>
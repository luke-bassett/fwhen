<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>{{.Page.Title}}</title>
  <link rel="stylesheet" type="text/css" href="/static/style.css">
</head>

<body>
  <script>
    // stackoverflow.com/questions/20618355
    function startTimer(duration, element) {
      var timer = duration;
      setInterval(function () {
        d = parseInt(timer / 86400, 10);
        h = parseInt(timer % 86400 / 3600, 10);
        m = parseInt(timer % 3600 / 60, 10);
        s = parseInt(timer % 60, 10);

        h = h < 10 ? "0" + h : h;
        m = m < 10 ? "0" + m : m;
        s = s < 10 ? "0" + s : s;

        element.textContent = d + "d " + h + "h " + m + "m " + s + "s";

        if (--timer < 0) {
          timer = duration;
        }
      }, 1000);
    }

    window.onload = function () {

      // get data
      const raceData = JSON.parse("{{.Page.Data}}")
      var racesDiv = document.getElementById("races")

      for (i = 0; i < raceData.length; i++) {
        let race = raceData[i]

        let raceNameSpan = document.createElement("span")
        raceNameSpan.innerHTML = race.Name
        raceNameSpan.className = "race_name"
        racesDiv.append(raceNameSpan)

        let raceDiv = document.createElement("div")
        raceDiv.className = "race_details"
        let sessionNamesDiv = document.createElement("div")
        sessionNamesDiv.className = "session_names"
        let timersDiv = document.createElement("div")
        timersDiv.className = "timers"

        for (j = 0; j < race.Sessions.length; j++) {
          let session = race.Sessions[j]

          let sessionNameSpan = document.createElement("span")
          sessionNameSpan.innerHTML = session.Name
          sessionNameSpan.className = "session_name"
          sessionNamesDiv.appendChild(sessionNameSpan)
          sessionNamesDiv.appendChild(document.createElement("br"))

          let timerSpan = document.createElement("span")
          startTimer(session.NsToStart / 10 ** 9, timerSpan)
          timersDiv.appendChild(timerSpan)
          timersDiv.appendChild(document.createElement("br"))
        }
        raceDiv.appendChild(sessionNamesDiv)
        raceDiv.appendChild(timersDiv)
        racesDiv.appendChild(raceDiv)
      }
    }
  </script>

  <div>
    <pre>   ____                    __    _      ____
  / __/__  ______ _  __ __/ /__ | | /| / / /  ___ ___
 / _// _ \/ __/  ' \/ // / / _ `/ |/ |/ / _ \/ -_) _ \
/_/  \___/_/ /_/_/_/\_,_/_/\_,_/|__/|__/_//_/\__/_//_/</pre>
  </div>
  <div id="races" class="races"></div>
</body>

</html>